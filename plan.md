# 📋 แผนอัพเดทเกม Bingo - ระบบ Multiplayer ผ่าน QR Code

## 🎯 ภาพรวมของโปรเจค

### สิ่งที่มีอยู่ปัจจุบัน
- เกม Bingo แบบ **Host Mode** ในไฟล์ `bingo.html`
- แสดงตาราง 50 หมายเลข (1-50)
- มีระบบประกาศเลขแบบ Manual (กดเลือกหรือพิมพ์เลข)
- มีประวัติการออกเลข, เอฟเฟกต์เสียง, และ Celebration animation

### สิ่งที่ต้องการเพิ่ม (ตามที่ผู้ใช้ร้องขอ)
1. ✅ **ระบบสร้าง QR Code** - ให้ผู้เล่นสแกนเข้าเกม
2. ✅ **แผ่นเกม Bingo บนมือถือ** - แต่ละคนได้เลข Random ไม่ซ้ำกัน
3. ✅ **ตารางแสดงผลผู้ชนะ** - แสดงสถานะว่าใคร Bingo ชนะ
4. ✅ **ระบบจับหมายเลขแบบ Random** - สุ่มเลขอัตโนมัติ

---

## 🏗️ สถาปัตยกรรมระบบใหม่

### แนวทางที่เลือก: **Local Server + WebSocket**

เนื่องจากต้องการให้ผู้เล่นหลายคนเล่นพร้อมกันและ sync ข้อมูล real-time จึงต้องมี Server

```
┌─────────────────────────────────────────────────────────────────┐
│                         สถาปัตยกรรมระบบ                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────┐          ┌─────────────────────────────┐  │
│   │   Host Screen   │◄────────►│      Node.js Server         │  │
│   │   (bingo.html)  │          │   (WebSocket + HTTP)        │  │
│   │  - แสดงตาราง     │          │   - จัดการ Game State       │  │
│   │  - ประกาศเลข     │          │   - สร้าง QR Code           │  │
│   │  - สุ่มหมายเลข   │          │   - จับคู่ผู้เล่น             │  │
│   └─────────────────┘          │   - ตรวจสอบผู้ชนะ           │  │
│                                └──────────┬──────────────────┘  │
│                                           │                     │
│            ┌──────────────────────────────┼──────────────────┐  │
│            │                              │                  │  │
│            ▼                              ▼                  ▼  │
│   ┌─────────────────┐          ┌─────────────────┐   ┌─────────┐│
│   │   Player 1      │          │   Player 2      │   │Player N ││
│   │   (mobile)      │          │   (mobile)      │   │(mobile) ││
│   │  - สแกน QR      │          │  - สแกน QR      │   │- สแกน QR ││
│   │  - ตาราง Random │          │  - ตาราง Random │   │- Random ││
│   │  - กดเลือกเลข   │          │  - กดเลือกเลข   │   │- กดเลข  ││
│   │  - แจ้ง Bingo   │          │  - แจ้ง Bingo   │   │- Bingo  ││
│   └─────────────────┘          └─────────────────┘   └─────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📁 โครงสร้างไฟล์ที่จะสร้างใหม่

```
d:\Binggo\
├── 📄 bingo.html              (แก้ไข - เพิ่มฟีเจอร์ Host)
├── 📄 player.html             (สร้างใหม่ - หน้าเล่นบนมือถือ)
├── 📄 server.js               (สร้างใหม่ - Node.js Server)
├── 📄 package.json            (สร้างใหม่ - Dependencies)
├── 📂 public/                 (สร้างใหม่ - Static files)
│   ├── 📄 player.html
│   └── 📄 player.css
├── 📄 Main-Background.jpg     (มีอยู่แล้ว)
├── 📄 Grid-Panel-Background.png
├── 📄 Header-Background.jpg
└── ...
```

---

## 🔧 รายละเอียดการพัฒนาทีละขั้นตอน

### ขั้นตอนที่ 1: สร้าง Node.js Server

**ไฟล์: `server.js`**

```javascript
// ฟังก์ชันหลักที่ต้องมี:

1. HTTP Server
   - เสิร์ฟไฟล์ static (HTML, CSS, Images)
   - API สำหรับสร้าง Game Session

2. WebSocket Server
   - รับ/ส่งข้อมูลแบบ real-time
   - Broadcast เลขที่ออกไปยังผู้เล่นทุกคน
   - รับการแจ้ง Bingo จากผู้เล่น

3. Game State Management
   - เก็บข้อมูล Session ของแต่ละเกม
   - เก็บข้อมูลผู้เล่นและตาราง Bingo ของแต่ละคน
   - เก็บเลขที่ออกแล้ว

4. QR Code Generation
   - สร้าง QR Code ที่มี URL สำหรับเข้าเกม
   - รวม Session ID ใน URL
```

**Dependencies ที่ต้องติดตั้ง:**
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "ws": "^8.14.2",
    "qrcode": "^1.5.3",
    "uuid": "^9.0.0"
  }
}
```

---

### ขั้นตอนที่ 2: สร้างหน้า Player (player.html)

**ฟีเจอร์ที่ต้องมี:**

#### 2.1 หน้าแรก - รอเข้าเกม
```
┌──────────────────────────────────┐
│          🎱 BINGO GAME           │
│                                  │
│  ┌────────────────────────────┐  │
│  │      กรอกชื่อของคุณ         │  │
│  │  ┌──────────────────────┐  │  │
│  │  │     [ชื่อผู้เล่น]      │  │  │
│  │  └──────────────────────┘  │  │
│  │                            │  │
│  │    [🎮 เข้าร่วมเกม]        │  │
│  └────────────────────────────┘  │
│                                  │
└──────────────────────────────────┘
```

#### 2.2 หน้าเกม - ตาราง Bingo ส่วนตัว
```
┌──────────────────────────────────┐
│  🎱 BINGO    เลขล่าสุด: [25]     │
├──────────────────────────────────┤
│  ┌──────────────────────────────┐│
│  │  B    I    N    G    O       ││
│  ├─────┬─────┬─────┬─────┬─────┤│
│  │ 03  │ 18  │ 35  │ 47  │ 62  ││
│  ├─────┼─────┼─────┼─────┼─────┤│
│  │ 11  │ 22  │ FREE│ 51  │ 70  ││
│  ├─────┼─────┼─────┼─────┼─────┤│
│  │ 07  │ 29  │ 44  │ 59  │ 75  ││
│  ├─────┼─────┼─────┼─────┼─────┤│
│  │ 14  │ 16  │ 31  │ 48  │ 68  ││
│  ├─────┼─────┼─────┼─────┼─────┤│
│  │ 05  │ 24  │ 42  │ 55  │ 71  ││
│  └─────┴─────┴─────┴─────┴─────┘│
│                                  │
│        [🎉 BINGO! ตะโกน]         │
│                                  │
└──────────────────────────────────┘
```

**หมายเหตุ:** 
- ตาราง Bingo จะมี 5x5 ช่อง (25 ช่อง)
- ช่องกลางเป็น FREE (ฟรี ไม่ต้องรอเลข)
- เลขจะถูก Random ไม่ซ้ำกันในแต่ละผู้เล่น
- เมื่อมีเลขออก ผู้เล่นกดที่ช่องนั้นเพื่อมาร์ค
- เมื่อครบแถว/คอลัมน์/แนวทแยง กด BINGO

---

### ขั้นตอนที่ 3: อัพเดท Host Page (bingo.html)

**ฟีเจอร์ใหม่ที่ต้องเพิ่ม:**

#### 3.1 ปุ่มและ UI ใหม่
```
┌────────────────────────────────────────────────────────────────────┐
│  🎱 BINGO BOARD                                                    │
│  ─────────────────────────────────────────────────────────────────│
│  [กรอกเลข: ___] [📢 ประกาศ] [🎲 สุ่มเลข] [🔊 เสียง]               │
│  [📱 QR Code] [👥 ผู้เล่น: 5] [🔄 รีเซ็ต]                          │
└────────────────────────────────────────────────────────────────────┘
```

#### 3.2 Modal แสดง QR Code
```
┌────────────────────────────────────────┐
│           📱 สแกนเข้าเกม                │
│  ┌─────────────────────────────────┐   │
│  │                                 │   │
│  │         [QR CODE IMAGE]         │   │
│  │                                 │   │
│  └─────────────────────────────────┘   │
│                                        │
│   URL: http://192.168.1.x:3000/play   │
│                                        │
│   ผู้เล่นที่เข้าร่วม: 5 คน             │
│   ┌──────────────────────────────┐    │
│   │ 1. สมชาย        🟢 ออนไลน์    │    │
│   │ 2. สมหญิง       🟢 ออนไลน์    │    │
│   │ 3. อนันต์       🟢 ออนไลน์    │    │
│   └──────────────────────────────┘    │
│                                        │
│           [❌ ปิด] [▶️ เริ่มเกม]        │
└────────────────────────────────────────┘
```

#### 3.3 Panel แสดงผู้เล่นและผู้ชนะ
```
┌───────────────────────────────────────┐
│      🏆 สถานะผู้เล่น                   │
├───────────────────────────────────────┤
│  ชื่อ          สถานะ       จำนวน Bingo │
│  ─────────────────────────────────────│
│  1. สมชาย     🟢 กำลังเล่น      0      │
│  2. สมหญิง   🎉 BINGO!        1      │
│  3. อนันต์    🟢 กำลังเล่น      0      │
│  4. มานี      🟢 กำลังเล่น      0      │
└───────────────────────────────────────┘
```

#### 3.4 ปุ่มจับหมายเลขแบบ Random
```
┌─────────────────────────────────────────────────┐
│                🎲 สุ่มหมายเลข                    │
│                                                 │
│   เลือกความเร็วในการสุ่ม:                        │
│   ○ ช้า (5 วินาที)                              │
│   ● ปกติ (3 วินาที)                             │
│   ○ เร็ว (1 วินาที)                             │
│                                                 │
│   [▶️ เริ่มสุ่ม]  [⏸️ หยุดชั่วคราว]  [⏹️ หยุด]   │
│                                                 │
│   เลขที่เหลือ: 35 / 50                          │
└─────────────────────────────────────────────────┘
```

---

### ขั้นตอนที่ 4: ระบบ Logic หลัก

#### 4.1 การสร้างตาราง Bingo แบบ Random

**อัลกอริทึม:**
```javascript
function generateBingoCard() {
    const card = [];
    const usedNumbers = new Set();
    
    // สำหรับเกม 50 เลข (1-50)
    // แบ่งเป็น 5 คอลัมน์ คอลัมน์ละ 10 เลข
    // B: 1-10, I: 11-20, N: 21-30, G: 31-40, O: 41-50
    
    for (let col = 0; col < 5; col++) {
        const columnNumbers = [];
        const min = col * 10 + 1;
        const max = min + 9;
        
        while (columnNumbers.length < 5) {
            const num = Math.floor(Math.random() * 10) + min;
            if (!usedNumbers.has(num)) {
                usedNumbers.add(num);
                columnNumbers.push(num);
            }
        }
        
        card.push(columnNumbers);
    }
    
    // กำหนด FREE ตรงกลาง (row 2, col 2)
    card[2][2] = 'FREE';
    
    return card;
}
```

#### 4.2 การตรวจสอบ Bingo

**เงื่อนไขชนะ:**
1. **แนวนอน** - ครบ 5 ช่องในแถวเดียวกัน
2. **แนวตั้ง** - ครบ 5 ช่องในคอลัมน์เดียวกัน
3. **แนวทแยง** - ครบ 5 ช่องแนวทแยง (มี 2 แนว)

```javascript
function checkBingo(markedPositions) {
    // ตรวจแนวนอน
    for (let row = 0; row < 5; row++) {
        if (checkLine([0,1,2,3,4].map(col => [row, col]), markedPositions)) {
            return true;
        }
    }
    
    // ตรวจแนวตั้ง
    for (let col = 0; col < 5; col++) {
        if (checkLine([0,1,2,3,4].map(row => [row, col]), markedPositions)) {
            return true;
        }
    }
    
    // ตรวจแนวทแยง
    if (checkLine([[0,0],[1,1],[2,2],[3,3],[4,4]], markedPositions)) {
        return true;
    }
    if (checkLine([[0,4],[1,3],[2,2],[3,1],[4,0]], markedPositions)) {
        return true;
    }
    
    return false;
}
```

#### 4.3 การสุ่มหมายเลขอัตโนมัติ

```javascript
let randomInterval = null;
let availableNumbers = [];

function startRandomDraw(speed = 3000) {
    // เริ่มต้นด้วยเลขที่ยังไม่ถูกเรียก
    availableNumbers = [...Array(50).keys()].map(n => n + 1)
        .filter(n => !calledNumbers.includes(n));
    
    randomInterval = setInterval(() => {
        if (availableNumbers.length === 0) {
            stopRandomDraw();
            return;
        }
        
        // สุ่มเลือกเลข
        const index = Math.floor(Math.random() * availableNumbers.length);
        const number = availableNumbers.splice(index, 1)[0];
        
        // ประกาศเลข
        callNumber(number);
        
        // Broadcast ไปยังผู้เล่นทุกคน
        broadcastNumber(number);
    }, speed);
}

function stopRandomDraw() {
    if (randomInterval) {
        clearInterval(randomInterval);
        randomInterval = null;
    }
}
```

---

### ขั้นตอนที่ 5: WebSocket Communication

#### 5.1 Events จาก Host ไป Player
| Event | ข้อมูลที่ส่ง | คำอธิบาย |
|-------|------------|---------|
| `number_called` | `{number: 25}` | เมื่อมีเลขออก |
| `game_reset` | `{}` | เมื่อรีเซ็ตเกม |
| `game_started` | `{}` | เมื่อเริ่มเกม |
| `player_won` | `{name: "สมหญิง"}` | เมื่อมีผู้ชนะ |

#### 5.2 Events จาก Player ไป Host
| Event | ข้อมูลที่ส่ง | คำอธิบาย |
|-------|------------|---------|
| `join_game` | `{name: "สมชาย"}` | เมื่อผู้เล่นเข้าร่วม |
| `claim_bingo` | `{playerId, markedCards}` | เมื่อตะโกน BINGO |
| `leave_game` | `{playerId}` | เมื่อผู้เล่นออก |

---

## 🚀 ขั้นตอนการติดตั้งและใช้งาน

### สำหรับ Host (ผู้จัดเกม)

1. **ติดตั้ง Node.js** (ถ้ายังไม่มี)
   ```bash
   # ดาวน์โหลดจาก https://nodejs.org
   ```

2. **ติดตั้ง Dependencies**
   ```bash
   cd d:\Binggo
   npm install
   ```

3. **เริ่ม Server**
   ```bash
   npm start
   # หรือ
   node server.js
   ```

4. **เปิดหน้า Host**
   ```
   เปิดเบราว์เซอร์ไปที่: http://localhost:3000
   ```

5. **สร้างเกมและแสดง QR Code**
   - กดปุ่ม "📱 QR Code"
   - แสดง QR Code บนหน้าจอใหญ่

### สำหรับ Player (ผู้เล่น)

1. **สแกน QR Code** ด้วยกล้องมือถือ
2. **กรอกชื่อ** และกด "เข้าร่วมเกม"
3. **รอ Host เริ่มเกม**
4. **เล่นเกม** - กดมาร์คเลขที่ออก
5. **ตะโกน BINGO** เมื่อครบแถว

---

## ⚙️ การตั้งค่าเพิ่มเติม

### Network Configuration

เพื่อให้มือถือเข้าถึง Server ได้:

1. **หา IP Address ของคอมพิวเตอร์**
   ```bash
   # Windows
   ipconfig
   
   # ดู IPv4 Address เช่น 192.168.1.100
   ```

2. **ตรวจสอบว่ามือถือและคอมพิวเตอร์อยู่ WiFi เดียวกัน**

3. **อนุญาต Firewall** (ถ้าจำเป็น)
   ```bash
   # Windows Firewall - อนุญาต Port 3000
   ```

4. **URL สำหรับผู้เล่น**
   ```
   http://[IP-ของคอมพิวเตอร์]:3000/play
   เช่น http://192.168.1.100:3000/play
   ```

---

## 🧪 แผนการทดสอบ (Verification Plan)

### A. การทดสอบแบบ Manual

#### ทดสอบที่ 1: ทดสอบ Server เริ่มทำงาน
```
1. เปิด Terminal/CMD
2. ไปที่ folder: cd d:\Binggo
3. รันคำสั่ง: npm start
4. ตรวจสอบว่าแสดง "Server running on port 3000"
5. เปิดเบราว์เซอร์ไปที่ http://localhost:3000
6. ✅ ผ่าน: เห็นหน้า Host แสดงตาราง Bingo
```

#### ทดสอบที่ 2: ทดสอบ QR Code
```
1. ในหน้า Host กดปุ่ม "📱 QR Code"
2. ✅ ผ่าน: แสดง Modal พร้อม QR Code
3. ใช้มือถือสแกน QR Code
4. ✅ ผ่าน: เปิดหน้าเว็บ player.html บนมือถือ
```

#### ทดสอบที่ 3: ทดสอบผู้เล่นเข้าเกม
```
1. บนมือถือ กรอกชื่อ "ผู้เล่น1"
2. กดปุ่ม "เข้าร่วมเกม"
3. ✅ ผ่าน: เห็นตาราง Bingo 5x5 พร้อมเลขสุ่ม
4. บนหน้า Host ตรวจสอบจำนวนผู้เล่น
5. ✅ ผ่าน: แสดง "ผู้เล่น: 1" และเห็นชื่อ "ผู้เล่น1"
```

#### ทดสอบที่ 4: ทดสอบประกาศเลข
```
1. บนหน้า Host กรอกเลข 25
2. กดปุ่ม "📢 ประกาศ"
3. ✅ ผ่าน (Host): เลข 25 ถูกไฮไลท์สีทอง
4. ✅ ผ่าน (Player): แสดง "เลขล่าสุด: 25" บนมือถือ
```

#### ทดสอบที่ 5: ทดสอบสุ่มหมายเลขอัตโนมัติ
```
1. บนหน้า Host กดปุ่ม "🎲 สุ่มเลข"
2. เลือกความเร็ว "ปกติ (3 วินาที)"
3. กด "▶️ เริ่มสุ่ม"
4. ✅ ผ่าน: มีเลขออกทุก 3 วินาที
5. ✅ ผ่าน: ผู้เล่นได้รับเลขที่ออก real-time
6. กด "⏹️ หยุด"
7. ✅ ผ่าน: หยุดสุ่มเลข
```

#### ทดสอบที่ 6: ทดสอบการมาร์คเลขและ Bingo
```
1. บนมือถือ กดที่ช่องที่มีเลขที่ออก
2. ✅ ผ่าน: ช่องถูกมาร์คสีเขียว
3. มาร์คจนครบแถว (5 ช่องแนวนอน/ตั้ง/ทแยง)
4. กดปุ่ม "🎉 BINGO!"
5. ✅ ผ่าน (Player): แสดง Celebration animation
6. ✅ ผ่าน (Host): แสดงแจ้งเตือน "ผู้เล่น1 ตะโกน BINGO!"
7. ✅ ผ่าน (Host): ตารางผู้เล่นแสดงสถานะ "🎉 BINGO!"
```

#### ทดสอบที่ 7: ทดสอบรีเซ็ตเกม
```
1. บนหน้า Host กดปุ่ม "🔄 รีเซ็ต"
2. ยืนยันใน Modal
3. ✅ ผ่าน (Host): ตารางกลับเป็นค่าเริ่มต้น
4. ✅ ผ่าน (Player): ได้ตาราง Bingo ใหม่ (เลขสุ่มใหม่)
```

### B. การทดสอบหลายผู้เล่น
```
1. เปิดหน้า player บน 3-4 อุปกรณ์ (มือถือ/tablet/browser tabs)
2. แต่ละอุปกรณ์กรอกชื่อต่างกัน
3. ✅ ผ่าน: Host เห็นรายชื่อผู้เล่นทุกคน
4. ✅ ผ่าน: แต่ละคนได้ตาราง Bingo ไม่เหมือนกัน
5. ประกาศเลข
6. ✅ ผ่าน: ทุกอุปกรณ์ได้รับเลขพร้อมกัน
```

---

## 📅 Timeline การพัฒนา (ประมาณการ)

| ขั้นตอน | งาน | เวลาโดยประมาณ |
|--------|-----|--------------|
| 1 | สร้าง package.json และติดตั้ง dependencies | 5 นาที |
| 2 | สร้าง server.js พื้นฐาน | 30 นาที |
| 3 | สร้างหน้า player.html | 1 ชั่วโมง |
| 4 | เพิ่ม WebSocket communication | 45 นาที |
| 5 | อัพเดท bingo.html (เพิ่ม QR, ผู้เล่น, สุ่มเลข) | 1 ชั่วโมง |
| 6 | ทดสอบและแก้ไข bug | 30 นาที |
| **รวม** | | **~4 ชั่วโมง** |

---

## ❓ คำถามที่ต้องยืนยันก่อนเริ่มพัฒนา

1. **จำนวนเลขในเกม**: ต้องการใช้ 50 เลข (1-50) เหมือนเดิม ถูกต้องไหม?

2. **ขนาดตาราง Bingo**: 
   - 5x5 (25 ช่อง, มี FREE ตรงกลาง) - มาตรฐาน
   - หรือขนาดอื่น?

3. **เงื่อนไขชนะ**: 
   - แถว/คอลัมน์/ทแยง ครบ 5 ช่อง - มาตรฐาน
   - หรือต้องการแบบอื่น เช่น ครบทั้งตาราง?

4. **ชื่อผู้เล่น**: 
   - กรอกเอง
   - หรือสร้างอัตโนมัติ (เช่น ผู้เล่น 1, ผู้เล่น 2...)?

5. **การรีเซ็ตเกม**: 
   - ผู้เล่นเดิมได้ตารางใหม่
   - หรือต้องสแกน QR ใหม่?

---

## 🔒 ข้อจำกัดและหมายเหตุ

1. **ต้องใช้ WiFi เดียวกัน** - คอมพิวเตอร์ Host และมือถือผู้เล่นต้องเชื่อมต่อ WiFi เดียวกัน

2. **ไม่มี HTTPS** - ใช้ HTTP เท่านั้น (อาจมีปัญหากับบางเบราว์เซอร์ที่ต้องการ HTTPS)

3. **ไม่มีฐานข้อมูล** - ข้อมูลเกมหายเมื่อปิด Server

4. **Node.js Required** - ต้องติดตั้ง Node.js บนเครื่อง Host

---

> 📝 **หมายเหตุ**: แผนนี้เขียนขึ้นเพื่อให้เข้าใจง่ายที่สุด หากมีข้อสงสัยหรือต้องการเปลี่ยนแปลงใดๆ สามารถแจ้งได้เลย!

